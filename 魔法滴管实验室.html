<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é­”æ³•æ»´ç®¡å®éªŒå®¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');
        
        :root {
            --panel-bg: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'ZCOOL+KuaiLe', -apple-system, sans-serif;
            background: linear-gradient(135deg, #fdf6e3 0%, #fae8ff 100%);
            min-height: 100vh;
            overscroll-behavior: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* é­”æ³•èƒŒæ™¯ç²’å­ */
        .magic-particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            filter: blur(2px);
            z-index: 0;
            animation: float-particle 10s infinite linear;
            opacity: 0.3;
        }
        @keyframes float-particle {
            0% { transform: translateY(110vh) translateX(0); }
            100% { transform: translateY(-10vh) translateX(20vw); }
        }

        .magic-table {
            background: var(--panel-bg);
            backdrop-filter: blur(10px);
            border: 4px solid white;
            box-shadow: 0 15px 40px rgba(0,0,0,0.1);
            border-radius: 40px;
            z-index: 10;
            width: 90vw;
            max-width: 380px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .lab-beaker {
            position: relative;
            width: 140px;
            height: 160px;
            border: 6px solid #4a5568;
            border-top: none;
            border-bottom-left-radius: 40px;
            border-bottom-right-radius: 40px;
            background: rgba(255, 255, 255, 0.4);
            overflow: hidden;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            transform: translateZ(0);
        }

        .liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5%;
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.8s ease;
        }

        .liquid::after {
            content: "";
            position: absolute;
            top: -10px;
            left: -50%;
            width: 200%;
            height: 20px;
            background: rgba(255,255,255,0.3);
            border-radius: 40%;
            animation: wave 3s infinite linear;
        }

        @keyframes wave { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* ç²¾çµåŠ¨ç”» */
        .monster-wrapper {
            cursor: grab;
            touch-action: none;
            transform: translateZ(0);
            transition: transform 0.2s;
        }

        .monster-red { animation: m-jump 2.5s infinite; }
        .monster-yellow { animation: m-pudding 3s infinite; transform-origin: bottom center; }
        .monster-blue { animation: m-sway 4.5s infinite; }

        @keyframes m-jump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes m-pudding { 0%, 100% { transform: scale(1, 1); } 50% { transform: scale(1.1, 0.9); } }
        @keyframes m-sway { 0%, 100% { transform: rotate(-5deg); } 50% { transform: rotate(5deg); } }

        .monster-eye {
            animation: blink 4s infinite;
            transform-origin: center;
        }
        @keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }

        .dragging {
            transform: scale(1.4) !important;
            opacity: 0.9;
            z-index: 1000 !important;
            pointer-events: none;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
        }

        .dropper {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
        }
        .dropper.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        .water-drop {
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 0 50% 50% 50%;
            transform: rotate(45deg);
            animation: drip-down 0.6s ease-in forwards;
        }

        @keyframes drip-down {
            0% { transform: translateY(0) rotate(45deg); }
            100% { transform: translateY(130px) rotate(45deg) scale(0); }
        }

        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 50%;
            animation: rise 1s forwards ease-out;
        }
        @keyframes rise { to { transform: translateY(-100px) scale(0); opacity: 0; } }
    </style>
</head>
<body>

    <header class="text-center mt-8 mb-4">
        <h1 class="text-2xl font-black text-orange-600 tracking-tight">âœ¨ é­”æ³•æ»´ç®¡å®éªŒå®¤ âœ¨</h1>
        <p class="text-orange-400 text-sm font-bold opacity-80">æ‹–åŠ¨ Q èŒç²¾çµï¼Œè°ƒé…å½©è‰²é­”æ³•ï¼</p>
    </header>

    <main class="magic-table">
        <div class="relative w-full flex justify-center mb-6 h-44">
            <div id="dropper" class="dropper">
                <svg width="30" height="70" viewBox="0 0 40 100">
                    <rect x="16" y="25" width="8" height="55" fill="#e2e8f0" rx="4" />
                    <circle id="dropper-color" cx="20" cy="20" r="18" fill="#cbd5e1" />
                    <path d="M18 80 L22 80 L20 95 Z" fill="#94a3b8" />
                </svg>
            </div>

            <div class="lab-beaker" id="beaker">
                <div id="liquid" class="liquid" style="background-color: #f1f5f9;"></div>
            </div>
        </div>

        <div id="result-text" class="text-center font-bold text-gray-500 mb-6 h-12 flex items-center justify-center leading-tight">
            å¿«å¿«å¿«ï¼<br>æ‹–ä¸ªé¢œè‰²è¿›æ¥å§ï¼
        </div>

        <div class="flex justify-around items-end w-full" id="color-palette">
            <!-- çº¢ç²¾çµ -->
            <div class="flex flex-col items-center">
                <div draggable="true" data-color="red" data-hex="#ef4444" class="monster-wrapper monster-red w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <circle cx="50" cy="55" r="35" fill="#ef4444" />
                        <circle class="monster-eye" cx="40" cy="50" r="5" fill="white" />
                        <circle class="monster-eye" cx="60" cy="50" r="5" fill="white" />
                        <circle cx="40" cy="50" r="2" fill="black" />
                        <circle cx="60" cy="50" r="2" fill="black" />
                        <path d="M45 68 Q50 72 55 68" stroke="white" stroke-width="2" fill="none" />
                    </svg>
                </div>
                <span class="text-red-500 text-xs mt-1 font-bold">çº¢ç²¾çµ</span>
            </div>
            <!-- é»„ç²¾çµ -->
            <div class="flex flex-col items-center">
                <div draggable="true" data-color="yellow" data-hex="#fbbf24" class="monster-wrapper monster-yellow w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <path d="M25 80 Q20 80 20 75 L22 45 Q22 35 35 35 L65 35 Q78 35 78 45 L80 75 Q80 80 75 80 Z" fill="#fbbf24" />
                        <circle class="monster-eye" cx="40" cy="55" r="6" fill="white" />
                        <circle class="monster-eye" cx="60" cy="55" r="6" fill="white" />
                        <circle cx="40" cy="55" r="3" fill="black" />
                        <circle cx="60" cy="55" r="3" fill="black" />
                    </svg>
                </div>
                <span class="text-yellow-600 text-xs mt-1 font-bold">é»„ç²¾çµ</span>
            </div>
            <!-- è“ç²¾çµ -->
            <div class="flex flex-col items-center">
                <div draggable="true" data-color="blue" data-hex="#3b82f6" class="monster-wrapper monster-blue w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <path d="M20 80 Q20 30 50 30 Q80 30 80 80 Z" fill="#3b82f6" />
                        <circle class="monster-eye" cx="50" cy="55" r="10" fill="white" />
                        <circle cx="50" cy="55" r="5" fill="black" />
                        <circle cx="50" cy="22" r="5" fill="#3b82f6" />
                        <line x1="50" y1="22" x2="50" y2="35" stroke="#3b82f6" stroke-width="3" />
                    </svg>
                </div>
                <span class="text-blue-600 text-xs mt-1 font-bold">è“ç²¾çµ</span>
            </div>
        </div>

        <button onclick="resetLab()" class="mt-8 w-full bg-orange-400 text-white py-3 rounded-2xl font-bold shadow-[0_4px_0_#c2410c] active:shadow-none active:translate-y-1 transition-all">
            ğŸ§¹ æ¸…ç†å®éªŒå®¤
        </button>
    </main>

    <footer class="mt-6 w-[90vw] max-w-[320px] p-4 bg-white/40 border border-white/60 rounded-2xl text-xs text-gray-500 shadow-sm">
        <p class="font-bold mb-1">ğŸª„ è°ƒè‰²å£è¯€ï¼š</p>
        <p>â¤ï¸ + ğŸ’› = ğŸ§¡ æ©™è‰² (å¤§æ©˜å­)</p>
        <p>ğŸ’› + ğŸ’™ = ğŸ’š ç»¿è‰² (å°é’è‰)</p>
        <p>â¤ï¸ + ğŸ’™ = ğŸ’œ ç´«è‰² (ç”œè‘¡è„)</p>
    </footer>

    <script>
        let currentColors = { red: false, yellow: false, blue: false };
        const liquid = document.getElementById('liquid');
        const resultText = document.getElementById('result-text');
        const beaker = document.getElementById('beaker');
        const dropper = document.getElementById('dropper');
        const dropperColor = document.getElementById('dropper-color');
        const monsters = document.querySelectorAll('.monster-wrapper');

        let draggedEl = null;
        let isAnimating = false;
        let offset = { x: 0, y: 0 };

        // èƒŒæ™¯ç²’å­ç”Ÿæˆ
        function createParticles() {
            for (let i = 0; i < 8; i++) {
                const p = document.createElement('div');
                p.className = 'magic-particle';
                const size = Math.random() * 30 + 15 + 'px';
                p.style.width = size; p.style.height = size;
                p.style.background = ['#ff9a9e', '#fad0c4', '#a1c4fd', '#c2e9fb'][i % 4];
                p.style.left = Math.random() * 100 + 'vw';
                p.style.animationDelay = Math.random() * 5 + 's';
                document.body.appendChild(p);
            }
        }
        createParticles();

        // æ¡Œé¢ç«¯æ”¯æŒ
        monsters.forEach(m => {
            m.addEventListener('dragstart', (e) => {
                if(isAnimating) { e.preventDefault(); return; }
                draggedEl = e.currentTarget;
                e.dataTransfer.setData('color', draggedEl.dataset.color);
                e.dataTransfer.setData('hex', draggedEl.dataset.hex);
            });
        });

        beaker.addEventListener('dragover', e => {
            e.preventDefault();
            beaker.style.transform = 'scale(1.1)';
        });
        beaker.addEventListener('dragleave', () => beaker.style.transform = 'scale(1)');
        beaker.addEventListener('drop', e => {
            e.preventDefault();
            beaker.style.transform = 'scale(1)';
            handleDrop(e.dataTransfer.getData('color'), e.dataTransfer.getData('hex'));
        });

        // ç§»åŠ¨ç«¯æ”¯æŒ
        monsters.forEach(m => {
            m.addEventListener('touchstart', e => {
                if (isAnimating) return;
                draggedEl = e.currentTarget;
                const touch = e.touches[0];
                const rect = draggedEl.getBoundingClientRect();
                offset.x = touch.clientX - rect.left;
                offset.y = touch.clientY - rect.top;
                draggedEl.classList.add('dragging');
                e.preventDefault();
            }, {passive: false});

            m.addEventListener('touchmove', e => {
                if (!draggedEl) return;
                const touch = e.touches[0];
                draggedEl.style.position = 'fixed';
                draggedEl.style.left = `${touch.clientX - offset.x}px`;
                draggedEl.style.top = `${touch.clientY - offset.y}px`;

                const bRect = beaker.getBoundingClientRect();
                if (touch.clientX > bRect.left && touch.clientX < bRect.right &&
                    touch.clientY > bRect.top && touch.clientY < bRect.bottom) {
                    beaker.style.transform = 'scale(1.15)'; // æ‰‹æœºç«¯ç¨å¾®æ”¾å¤§æ˜æ˜¾ä¸€ç‚¹
                } else {
                    beaker.style.transform = 'scale(1)';
                }
                e.preventDefault();
            }, {passive: false});

            m.addEventListener('touchend', e => {
                if (!draggedEl) return;
                const touch = e.changedTouches[0];
                const bRect = beaker.getBoundingClientRect();

                if (touch.clientX > bRect.left && touch.clientX < bRect.right &&
                    touch.clientY > bRect.top && touch.clientY < bRect.bottom) {
                    handleDrop(draggedEl.dataset.color, draggedEl.dataset.hex);
                }

                draggedEl.classList.remove('dragging');
                draggedEl.style.position = '';
                draggedEl.style.left = '';
                draggedEl.style.top = '';
                beaker.style.transform = 'scale(1)';
                draggedEl = null;
            });
        });

        function handleDrop(color, hex) {
            if (!color || currentColors[color] || isAnimating) return;
            isAnimating = true;

            dropperColor.setAttribute('fill', hex);
            dropper.classList.add('show');

            setTimeout(() => {
                const drop = document.createElement('div');
                drop.className = 'water-drop';
                drop.style.backgroundColor = hex;
                drop.style.left = '50%';
                drop.style.marginLeft = '-6px';
                beaker.appendChild(drop);

                setTimeout(() => {
                    drop.remove();
                    currentColors[color] = true;
                    updateUI();
                    createBubbles();
                    setTimeout(() => {
                        dropper.classList.remove('show');
                        isAnimating = false;
                    }, 300);
                }, 550);
            }, 400);
        }

        function createBubbles() {
            for(let i=0; i<8; i++) {
                setTimeout(() => {
                    const b = document.createElement('div');
                    b.className = 'bubble';
                    const s = (Math.random() * 12 + 4) + 'px';
                    b.style.width = s; b.style.height = s;
                    b.style.left = (Math.random() * 80 + 10) + '%';
                    b.style.bottom = '10px';
                    beaker.appendChild(b);
                    setTimeout(() => b.remove(), 1000);
                }, i * 80);
            }
        }

        function resetLab() {
            if (isAnimating) return;
            currentColors = { red: false, yellow: false, blue: false };
            updateUI();
        }

        function updateUI() {
            const { red, yellow, blue } = currentColors;
            let hex = '#f1f5f9';
            let msg = "å†åŠ ç‚¹é¢œè‰²è¿›æ¥å§ï¼";
            const count = Object.values(currentColors).filter(Boolean).length;

            if (count === 0) {
                msg = "å¿«å¿«å¿«ï¼<br>æ‹–ä¸ªé¢œè‰²è¿›æ¥å§ï¼";
            } else if (red && yellow && blue) {
                hex = '#3d2b1f';
                msg = "å¤©å‘ï¼å…¨æ»¡äº†ï¼<br>å˜æˆäº†ã€å¥‡è¿¹æ£•ã€‘ï¼";
            } else if (red && yellow) {
                hex = '#f97316'; msg = "å˜¿ï¼å˜æˆäº†ã€æ©™è‰²ã€‘ï¼";
            } else if (yellow && blue) {
                hex = '#22c55e'; msg = "å“‡ï¼å˜æˆäº†ã€ç»¿è‰²ã€‘ï¼";
            } else if (red && blue) {
                hex = '#a855f7'; msg = "ç§ï¼å˜æˆäº†ã€ç´«è‰²ã€‘ï¼";
            } else {
                if (red) hex = '#ef4444';
                if (yellow) hex = '#fbbf24';
                if (blue) hex = '#3b82f6';
                msg = "é­”æ³•æ³¨å…¥ä¸­...<br>å†è¯•è¯•åŠ ä¸€ç§ï¼Ÿ";
            }

            liquid.style.backgroundColor = hex;
            liquid.style.height = count === 0 ? '5%' : (33 * count) + '%';
            resultText.innerHTML = msg;
        }
    </script>
</body>
</html>