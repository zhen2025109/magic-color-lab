<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <!-- è§†å£è®¾ç½®ï¼šç¦æ­¢ç¼©æ”¾ï¼Œé€‚é…åˆ˜æµ·å±ï¼Œé”å®šå®½é«˜ç­‰æ¯” -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é­”æ³•æ»´ç®¡å®éªŒå®¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');
        
        :root {
            --panel-bg: rgba(255, 255, 255, 0.95);
            --glass-border: #64748b;
        }

        body {
            font-family: 'ZCOOL+KuaiLe', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #fdf6e3 0%, #fae8ff 100%);
            min-height: 100vh;
            overscroll-behavior: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* èƒŒæ™¯è£…é¥°ç²’å­ */
        .magic-particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            filter: blur(2px);
            z-index: 0;
            animation: float-particle 10s infinite linear;
            opacity: 0.3;
        }
        @keyframes float-particle {
            0% { transform: translateY(110vh) translateX(0); }
            100% { transform: translateY(-10vh) translateX(20vw); }
        }

        .magic-table {
            background: var(--panel-bg);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 4px solid white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            border-radius: 40px;
            z-index: 10;
            width: 90vw;
            max-width: 380px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        /* çƒ§æ¯ç»„ä»¶ */
        .beaker-container {
            position: relative;
            width: 160px;
            height: 180px;
            margin: 0 auto;
            transform-origin: center bottom;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ä»…åœ¨å‡†å¤‡æ”¾å…¥æ—¶è½»å¾®æ”¾å¤§ */
        .beaker-container.ready {
            transform: scale(1.08);
        }

        .beaker-glass {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 130px;
            height: 160px;
            background: rgba(255,255,255,0.2);
            border: 4px solid var(--glass-border);
            border-top: none;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            overflow: hidden;
            z-index: 2;
            box-shadow: inset -5px 0 15px rgba(255,255,255,0.4);
        }

        .beaker-rim {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 14px;
            border: 4px solid var(--glass-border);
            background: white;
            border-radius: 20px;
            z-index: 6; 
        }

        .beaker-face {
            position: absolute;
            top: 55px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            z-index: 5;
            opacity: 0.7;
            animation: face-float 4s infinite ease-in-out;
            pointer-events: none;
        }
        
        @keyframes face-float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(4px); }
        }

        .beaker-eye {
            width: 8px;
            height: 8px;
            background: #475569;
            border-radius: 50%;
            animation: beaker-blink 4s infinite;
        }

        .beaker-mouth {
            width: 14px;
            height: 8px;
            border-bottom: 3px solid #475569;
            border-radius: 0 0 10px 10px;
            transition: all 0.3s;
        }

        .ready .beaker-mouth {
            width: 10px;
            height: 10px;
            border: 3px solid #475569;
            border-radius: 50%;
            background: transparent;
        }

        @keyframes beaker-blink { 
            0%, 90%, 100% { transform: scaleY(1); } 
            95% { transform: scaleY(0.1); } 
        }

        .liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5%;
            transition: height 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), background-color 0.8s ease;
            box-shadow: inset 0 5px 15px rgba(255,255,255,0.2);
            will-change: height, background-color;
        }

        .liquid-bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: bubble-rise 2s ease-out forwards;
        }

        @keyframes bubble-rise {
            0% { transform: translateY(0) scale(0.3); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-80px) scale(1.2); opacity: 0; }
        }

        /* æ€ªç‰©ç²¾çµæ ·å¼ */
        .monster-wrapper {
            cursor: grab;
            touch-action: none;
            will-change: transform, left, top;
            -webkit-touch-callout: none;
            position: relative; /* ç¡®ä¿åˆå§‹å®šä½æ­£ç¡® */
        }
        
        .monster-red { animation: m-jump 2.5s infinite, m-red-heartbeat 2s infinite ease-in-out; }
        .monster-yellow { animation: m-pudding 3s infinite; transform-origin: bottom center; }
        .monster-blue { animation: m-sway 4.5s infinite; }

        @keyframes m-jump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes m-red-heartbeat { 0%, 100% { transform: scale(0.88); } 50% { transform: scale(0.93); } }
        @keyframes m-pudding { 0%, 100% { transform: scale(1, 1); } 50% { transform: scale(1.15, 0.85); } }
        @keyframes m-sway { 0%, 100% { transform: rotate(-8deg); } 50% { transform: rotate(8deg); } }

        /* æ‹–æ‹½æ€æ ¸å¿ƒä¿®æ­£ï¼šè§£å†³è·³åŠ¨ */
        .dragging {
            position: fixed !important;
            margin: 0 !important;
            z-index: 9999 !important;
            pointer-events: none !important;
            transition: transform 0.1s ease-out !important; /* æè½»å¾®è·Ÿéšæ„Ÿ */
            transform: scale(1.3) !important;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.15));
            animation: none !important; /* æ‹–æ‹½æ—¶åœæ­¢åŸæœ¬çš„è·³åŠ¨åŠ¨ç”» */
        }

        .dropper {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            z-index: 20;
        }
        .dropper.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        .water-drop {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 0 50% 50% 50%;
            transform: rotate(45deg);
            animation: drip-down 0.6s ease-in forwards;
            z-index: 15;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.1);
        }
        @keyframes drip-down {
            0% { transform: translateY(0) rotate(45deg); }
            100% { transform: translateY(145px) rotate(45deg) scale(0); }
        }

        .guide-box {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 12px;
            padding: 10px;
            margin-top: 15px;
            font-size: 0.8rem;
            color: #64748b;
        }
    </style>
</head>
<body oncontextmenu="return false;">

    <header class="text-center mt-8 mb-4">
        <h1 class="text-2xl font-black text-orange-600 tracking-tight mb-2">âœ¨ é­”æ³•æ»´ç®¡å®éªŒå®¤ âœ¨</h1>
        <p class="text-orange-400 text-sm font-bold opacity-80">æ‹–åŠ¨ Q èŒç²¾çµï¼Œè°ƒé…å½©è‰²é­”æ³•ï¼</p>
    </header>

    <main class="magic-table">
        <div class="relative w-full flex justify-center mb-6 h-48">
            <div id="dropper" class="dropper">
                <svg width="30" height="70" viewBox="0 0 40 100">
                    <rect x="16" y="25" width="8" height="55" fill="#e2e8f0" rx="4" />
                    <circle id="dropper-color" cx="20" cy="20" r="18" fill="#cbd5e1" />
                    <path d="M18 80 L22 80 L20 95 Z" fill="#94a3b8" />
                </svg>
            </div>

            <div class="beaker-container" id="beaker">
                <div class="beaker-rim"></div>
                <div class="beaker-glass">
                    <div class="beaker-face">
                        <div class="flex gap-6">
                            <div class="beaker-eye"></div>
                            <div class="beaker-eye"></div>
                        </div>
                        <div class="beaker-mouth"></div>
                    </div>
                    <div id="liquid" class="liquid" style="background-color: #f8fafc;"></div>
                </div>
            </div>
        </div>

        <div id="result-text" class="text-center font-bold text-gray-500 mb-6 h-12 flex items-center justify-center leading-tight">
            å¿«å¿«å¿«ï¼<br>æ‹–ä¸ªé¢œè‰²è¿›æ¥å§ï¼
        </div>

        <div class="flex justify-around items-end w-full" id="color-palette">
            <div class="flex flex-col items-center">
                <div data-color="red" data-hex="#ef4444" class="monster-wrapper monster-red w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <defs><radialGradient id="redGrad" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#ff6b6b"/><stop offset="100%" style="stop-color:#ef4444"/></radialGradient></defs>
                        <path d="M50 25 Q55 10 65 15" stroke="#b91c1c" stroke-width="3" fill="none" />
                        <ellipse cx="50" cy="58" rx="40" ry="36" fill="url(#redGrad)" />
                        <g class="monster-eye"><circle cx="40" cy="52" r="7.5" fill="white"/><circle cx="60" cy="52" r="7.5" fill="white"/><circle cx="40" cy="53" r="4.5" fill="#450a0a"/><circle cx="60" cy="53" r="4.5" fill="#450a0a"/></g>
                        <path d="M45 74 Q50 79 55 74" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    </svg>
                </div>
                <span class="text-red-500 text-xs mt-1 font-bold">çº¢ç²¾çµ</span>
            </div>

            <div class="flex flex-col items-center">
                <div data-color="yellow" data-hex="#fbbf24" class="monster-wrapper monster-yellow w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <path d="M22 85 Q20 85 20 80 L23 45 Q25 30 50 30 Q75 30 77 45 L80 80 Q80 85 78 85 Z" fill="#fbbf24" />
                        <g class="monster-eye"><circle cx="40" cy="58" r="8" fill="white"/><circle cx="60" cy="58" r="8" fill="white"/><circle cx="40" cy="58" r="4.5" fill="#451a03"/><circle cx="60" cy="58" r="4.5" fill="#451a03"/></g>
                        <circle cx="50" cy="72" r="3.5" fill="#92400e" />
                    </svg>
                </div>
                <span class="text-yellow-600 text-xs mt-1 font-bold">é»„ç²¾çµ</span>
            </div>

            <div class="flex flex-col items-center">
                <div data-color="blue" data-hex="#3b82f6" class="monster-wrapper monster-blue w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <defs><radialGradient id="blueGrad" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#60a5fa"/><stop offset="100%" style="stop-color:#3b82f6"/></radialGradient></defs>
                        <path d="M50 28 C25 28 15 50 15 70 C15 85 30 92 50 92 C70 92 85 85 85 70 C85 50 75 28 50 28 Z" fill="url(#blueGrad)" />
                        <g class="monster-eye"><circle cx="40" cy="62" r="8" fill="white"/><circle cx="60" cy="62" r="8" fill="white"/><circle cx="40" cy="63" r="4.5" fill="#1e3a8a"/><circle cx="60" cy="63" r="4.5" fill="#1e3a8a"/></g>
                        <path d="M46 78 Q50 82 54 78" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    </svg>
                </div>
                <span class="text-blue-600 text-xs mt-1 font-bold">è“ç²¾çµ</span>
            </div>
        </div>

        <button onclick="resetLab()" class="mt-8 w-full bg-orange-400 text-white py-3 rounded-2xl font-bold shadow-[0_4px_0_#c2410c] active:shadow-none active:translate-y-1 transition-all">
            ğŸ§¹ æ¸…ç†å®éªŒå®¤
        </button>

        <div class="guide-box">
            <p class="font-bold mb-1">ğŸ§ª è°ƒè‰²å£è¯€ï¼š</p>
            <p>â¤ï¸ + ğŸ’› = ğŸ§¡ æ©™è‰² (å¤§æ©˜å­)</p>
            <p>ğŸ’› + ğŸ’™ = ğŸ’š ç»¿è‰² (å°é’è‰)</p>
            <p>â¤ï¸ + ğŸ’™ = ğŸ’œ ç´«è‰² (ç”œè‘¡è„)</p>
        </div>
    </main>

    <script>
        // ---------------- å…¨å±€å˜é‡å®šä¹‰ ----------------
        let currentColors = { red: false, yellow: false, blue: false };
        let isAnimating = false;
        let bubbleInterval = null;
        
        let draggedEl = null;
        let offset = { x: 0, y: 0 }; // è®°å½•æ‰‹æŒ‡ç›¸å¯¹å…ƒç´ ä¸­å¿ƒçš„åç§»

        const liquid = document.getElementById('liquid');
        const resultText = document.getElementById('result-text');
        const beaker = document.getElementById('beaker');
        const beakerInner = beaker.querySelector('.beaker-glass');
        const dropper = document.getElementById('dropper');
        const dropperColor = document.getElementById('dropper-color');
        const monsters = document.querySelectorAll('.monster-wrapper');

        // ---------------- æ ¸å¿ƒæ‹–æ‹½é€»è¾‘å‡½æ•° (å…¨å±€ä½œç”¨åŸŸ) ----------------

        function updatePosition(clientX, clientY) {
            if (!draggedEl) return;
            
            // è®¡ç®—æ–°çš„åæ ‡ï¼Œç¡®ä¿æ‰‹æŒ‡åœ¨åˆå§‹ç‚¹å‡»ä½ç½®
            // clientX/Y æ˜¯ç›¸å¯¹äºè§†å£çš„ï¼Œfixed å®šä½ä¹Ÿæ˜¯ç›¸å¯¹äºè§†å£çš„ï¼Œç›´æ¥èµ‹å€¼å³å¯
            const x = clientX - offset.x;
            const y = clientY - offset.y;
            
            draggedEl.style.left = `${x}px`;
            draggedEl.style.top = `${y}px`;

            // å®æ—¶æ£€æµ‹ç¢°æ’
            const bRect = beaker.getBoundingClientRect();
            const mRect = draggedEl.getBoundingClientRect();
            if (checkCollision(mRect, bRect)) {
                beaker.classList.add('ready');
            } else {
                beaker.classList.remove('ready');
            }
        }

        function handleStart(clientX, clientY, target) {
            if (isAnimating) return;
            draggedEl = target;
            const initialRect = draggedEl.getBoundingClientRect();
            
            // å…³é”®ï¼šè®¡ç®—ç‚¹å‡»ç‚¹ç›¸å¯¹äºå…ƒç´ å·¦ä¸Šè§’çš„åç§»é‡
            offset.x = clientX - initialRect.left;
            offset.y = clientY - initialRect.top;

            // é”å®šå®½é«˜ï¼Œé˜²æ­¢ position: fixed åå˜å½¢
            draggedEl.style.width = initialRect.width + 'px';
            draggedEl.style.height = initialRect.height + 'px';
            
            // ç«‹å³è®¾ç½®åˆå§‹ä½ç½®ï¼Œé˜²æ­¢è·³åŠ¨
            draggedEl.style.left = initialRect.left + 'px';
            draggedEl.style.top = initialRect.top + 'px';
            
            // å¯ä»¥åœ¨ä¸‹ä¸€å¸§åº”ç”¨æ ·å¼ï¼Œæˆ–è€…ç›´æ¥åº”ç”¨ã€‚è¿™é‡Œä¸ºäº†ç¨³å¦¥ç›´æ¥æ·»åŠ ç±»ã€‚
            draggedEl.classList.add('dragging');
            
            if (navigator.vibrate) navigator.vibrate(10);
        }

        function handleEnd() {
            if (!draggedEl) return;
            
            const bRect = beaker.getBoundingClientRect();
            const mRect = draggedEl.getBoundingClientRect();
            const color = draggedEl.dataset.color;
            const hex = draggedEl.dataset.hex;

            beaker.classList.remove('ready');
            draggedEl.classList.remove('dragging');
            draggedEl.style.position = '';
            draggedEl.style.left = '';
            draggedEl.style.top = '';
            draggedEl.style.width = '';
            draggedEl.style.height = '';

            if (checkCollision(mRect, bRect)) {
                handleDrop(color, hex);
            }
            draggedEl = null;
        }

        function checkCollision(r1, r2) {
            return !(r1.right < r2.left || r1.left > r2.right || r1.bottom < r2.top || r1.top > r2.bottom);
        }

        // ---------------- äº‹ä»¶ç»‘å®š ----------------

        monsters.forEach(m => {
            // Touch Events
            m.addEventListener('touchstart', e => {
                const touch = e.touches[0];
                handleStart(touch.clientX, touch.clientY, e.currentTarget);
                e.preventDefault(); // é˜²æ­¢æ»šåŠ¨
            }, { passive: false });

            // Mouse Events
            m.addEventListener('mousedown', e => {
                handleStart(e.clientX, e.clientY, e.currentTarget);
            });
        });

        // å…¨å±€ Move ç›‘å¬
        window.addEventListener('touchmove', e => {
            if (!draggedEl) return;
            const touch = e.touches[0];
            updatePosition(touch.clientX, touch.clientY);
            e.preventDefault(); // é˜²æ­¢æ»šåŠ¨
        }, { passive: false });

        window.addEventListener('mousemove', e => {
            if (!draggedEl) return;
            updatePosition(e.clientX, e.clientY);
        });

        // å…¨å±€ End ç›‘å¬
        window.addEventListener('touchend', handleEnd);
        window.addEventListener('touchcancel', handleEnd);
        window.addEventListener('mouseup', handleEnd);

        // ---------------- æ¸¸æˆä¸šåŠ¡é€»è¾‘ ----------------

        function handleDrop(color, hex) {
            if (currentColors[color] || isAnimating) return;
            isAnimating = true;

            dropperColor.setAttribute('fill', hex);
            dropper.classList.add('show');
            
            setTimeout(() => {
                const drop = document.createElement('div');
                drop.className = 'water-drop';
                drop.style.backgroundColor = hex;
                drop.style.left = '50%';
                drop.style.marginLeft = '-7px';
                beaker.appendChild(drop);
                
                setTimeout(() => {
                    drop.remove();
                    currentColors[color] = true;
                    updateUI();
                    startBubblingEffect();
                    if (navigator.vibrate) navigator.vibrate(20);
                    
                    // å·²ç§»é™¤çƒ§æ¯çš„å¿«é€ŸæŠ–åŠ¨åŠ¨ç”» (beaker.animate)
                    // ä»…ä¿ç•™çŠ¶æ€é‡ç½®å’Œæ»´ç®¡æ”¶å›
                    setTimeout(() => {
                        dropper.classList.remove('show');
                        isAnimating = false;
                    }, 300);
                }, 550);
            }, 300);
        }

        function startBubblingEffect() {
            for(let i=0; i<8; i++) setTimeout(createOneBubble, i * 150);
            if(!bubbleInterval) {
                bubbleInterval = setInterval(createOneBubble, 1000);
            }
        }

        function createOneBubble() {
            if (!Object.values(currentColors).some(v => v)) return;
            const b = document.createElement('div');
            b.className = 'liquid-bubble';
            const size = (Math.random() * 10 + 6) + 'px';
            b.style.width = size; b.style.height = size;
            b.style.left = (Math.random() * 60 + 20) + '%';
            b.style.bottom = '10px';
            beakerInner.appendChild(b);
            setTimeout(() => b.remove(), 2000);
        }

        function updateUI() {
            const { red, yellow, blue } = currentColors;
            let hex = '#f8fafc';
            let msg = "å†åŠ ç‚¹é¢œè‰²è¿›æ¥å§ï¼";
            const count = Object.values(currentColors).filter(Boolean).length;
            
            if (count === 0) {
                msg = "å¿«å¿«å¿«ï¼<br>æ‹–ä¸ªé¢œè‰²è¿›æ¥å§ï¼";
            } else if (red && yellow && blue) {
                hex = '#451a03'; msg = "å“‡ï¼å˜æˆé…·é…·çš„ã€å¥‡è¿¹æ£•ã€‘ï¼";
            } else if (red && yellow) {
                hex = '#fb923c'; msg = "å˜¿ï¼å˜æˆäº†ã€æ©™è‰²ã€‘å¤§æ©˜å­ï¼";
            } else if (yellow && blue) {
                hex = '#4ade80'; msg = "å“‡ï¼å˜æˆäº†ã€ç»¿è‰²ã€‘å°é’è‰ï¼";
            } else if (red && blue) {
                hex = '#c084fc'; msg = "ç§ï¼å˜æˆäº†ã€ç´«è‰²ã€‘ç”œè‘¡è„ï¼";
            } else {
                if (red) hex = '#f87171';
                if (yellow) hex = '#fbbf24';
                if (blue) hex = '#60a5fa';
                msg = "é­”æ³•æ³¨å…¥ä¸­...<br>å†è¯•è¯•åŠ ä¸€ç§ï¼Ÿ";
            }
            
            liquid.style.backgroundColor = hex;
            liquid.style.height = count === 0 ? '5%' : (Math.min(count * 30, 90)) + '%';
            resultText.innerHTML = msg;
        }

        function resetLab() {
            if (isAnimating) return;
            currentColors = { red: false, yellow: false, blue: false };
            updateUI();
            if(bubbleInterval) { clearInterval(bubbleInterval); bubbleInterval = null; }
            if (navigator.vibrate) navigator.vibrate(20);
        }

        // èƒŒæ™¯ç²’å­åˆå§‹åŒ–
        for (let i = 0; i < 6; i++) {
            const p = document.createElement('div');
            p.className = 'magic-particle';
            const size = Math.random() * 20 + 20 + 'px';
            p.style.width = size; p.style.height = size;
            p.style.background = ['#ff9a9e', '#fad0c4', '#a1c4fd', '#c2e9fb'][i % 4];
            p.style.left = Math.random() * 100 + 'vw';
            p.style.animationDelay = Math.random() * 5 + 's';
            document.body.appendChild(p);
        }
    </script>
</body>
</html>
