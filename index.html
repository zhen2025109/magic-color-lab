<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>é­”æ³•æ»´ç®¡å®éªŒå®¤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=ZCOOL+KuaiLe&display=swap');
        
        :root {
            --panel-bg: rgba(255, 255, 255, 0.95);
            --glass-border: #64748b;
        }

        body {
            font-family: 'ZCOOL+KuaiLe', -apple-system, sans-serif;
            background: linear-gradient(135deg, #fdf6e3 0%, #fae8ff 100%);
            min-height: 100vh;
            overscroll-behavior: none;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            touch-action: none;
            -webkit-user-select: none;
            user-select: none;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .magic-particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            filter: blur(2px);
            z-index: 0;
            animation: float-particle 10s infinite linear;
            opacity: 0.3;
        }
        @keyframes float-particle {
            0% { transform: translateY(110vh) translateX(0); }
            100% { transform: translateY(-10vh) translateX(20vw); }
        }

        .magic-table {
            background: var(--panel-bg);
            backdrop-filter: blur(15px);
            border: 4px solid white;
            box-shadow: 0 20px 50px rgba(0,0,0,0.1);
            border-radius: 40px;
            z-index: 10;
            width: 90vw;
            max-width: 380px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .beaker-container {
            position: relative;
            width: 160px;
            height: 180px;
            margin: 0 auto;
            perspective: 500px;
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* æ‚¬åœ/å‡†å¤‡æ¥æ”¶çŠ¶æ€ */
        .beaker-container.ready {
            transform: scale(1.15);
        }

        .beaker-glass {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 130px;
            height: 160px;
            background: rgba(255,255,255,0.2);
            border: 4px solid var(--glass-border);
            border-top: none;
            border-bottom-left-radius: 30px;
            border-bottom-right-radius: 30px;
            overflow: hidden;
            z-index: 2;
            box-shadow: inset -5px 0 15px rgba(255,255,255,0.4);
        }

        .beaker-glass::before {
            content: "";
            position: absolute;
            top: 0;
            left: 15px;
            width: 8px;
            height: 100%;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.5), transparent);
            z-index: 5;
        }

        .beaker-rim {
            position: absolute;
            top: 16px;
            left: 50%;
            transform: translateX(-50%);
            width: 140px;
            height: 14px;
            border: 4px solid var(--glass-border);
            background: white;
            border-radius: 20px;
            z-index: 6; 
        }

        .beaker-face {
            position: absolute;
            top: 55px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            z-index: 5;
            opacity: 0.7;
            animation: face-float 4s infinite ease-in-out;
        }
        
        @keyframes face-float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(4px); }
        }

        .eyes-row {
            display: flex;
            gap: 24px;
        }

        .beaker-eye {
            width: 8px;
            height: 8px;
            background: #475569;
            border-radius: 50%;
            animation: beaker-blink 4s infinite;
        }

        .beaker-mouth {
            width: 14px;
            height: 8px;
            border-bottom: 3px solid #475569;
            border-radius: 0 0 10px 10px;
            transition: all 0.3s;
        }

        /* å‡†å¤‡æ¥æ”¶æ—¶å˜´å·´å˜åœ†ï¼ˆæƒŠè®¶ï¼‰ */
        .ready .beaker-mouth {
            width: 12px;
            height: 12px;
            border: 3px solid #475569;
            border-radius: 50%;
        }

        @keyframes beaker-blink { 
            0%, 90%, 100% { transform: scaleY(1); } 
            95% { transform: scaleY(0.1); } 
        }

        .liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 5%;
            transition: height 1s cubic-bezier(0.4, 0, 0.2, 1), background-color 0.8s ease;
            box-shadow: inset 0 5px 15px rgba(255,255,255,0.2);
        }

        .liquid::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.3);
            filter: blur(2px);
        }

        .liquid-bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            pointer-events: none;
            animation: bubble-rise 2s ease-out forwards;
        }

        @keyframes bubble-rise {
            0% { transform: translateY(0) scale(0.3); opacity: 0; }
            20% { opacity: 0.8; }
            100% { transform: translateY(-80px) scale(1.2); opacity: 0; }
        }

        .monster-wrapper {
            cursor: grab;
            touch-action: none;
            transform: translateZ(0);
            transition: transform 0.2s;
            -webkit-touch-callout: none;
        }
        .monster-red { animation: m-jump 2.5s infinite, m-red-heartbeat 2s infinite ease-in-out; }
        .monster-yellow { animation: m-pudding 3s infinite; transform-origin: bottom center; }
        .monster-blue { animation: m-sway 4.5s infinite; }

        @keyframes m-jump { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
        @keyframes m-red-heartbeat { 0%, 100% { transform: scale(0.88); } 50% { transform: scale(0.93); } }
        @keyframes m-pudding { 0%, 100% { transform: scale(1, 1); } 50% { transform: scale(1.15, 0.85); } }
        @keyframes m-sway { 0%, 100% { transform: rotate(-8deg); } 50% { transform: rotate(8deg); } }

        .monster-eye { animation: blink 4s infinite; transform-origin: center; }
        @keyframes blink { 0%, 90%, 100% { transform: scaleY(1); } 95% { transform: scaleY(0.1); } }

        .dragging {
            transform: scale(1.4) !important;
            opacity: 0.9;
            z-index: 1000 !important;
            pointer-events: none;
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.2));
            transition: none !important;
        }

        .dropper {
            position: absolute;
            top: -50px;
            left: 50%;
            transform: translateX(-50%) translateY(-20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            pointer-events: none;
            z-index: 20;
        }
        .dropper.show { opacity: 1; transform: translateX(-50%) translateY(0); }

        .water-drop {
            position: absolute;
            width: 14px;
            height: 14px;
            border-radius: 0 50% 50% 50%;
            transform: rotate(45deg);
            animation: drip-down 0.6s ease-in forwards;
            z-index: 15;
            box-shadow: inset -2px -2px 5px rgba(0,0,0,0.1);
        }
        @keyframes drip-down {
            0% { transform: translateY(0) rotate(45deg); }
            100% { transform: translateY(145px) rotate(45deg) scale(0); }
        }
    </style>
</head>
<body>

    <header class="text-center mt-8 mb-4">
        <h1 class="text-2xl font-black text-orange-600 tracking-tight mb-2">âœ¨ é­”æ³•æ»´ç®¡å®éªŒå®¤ âœ¨</h1>
        <p class="text-orange-400 text-sm font-bold opacity-80">æ‹–åŠ¨ Q èŒç²¾çµï¼Œè°ƒé…å½©è‰²é­”æ³•ï¼</p>
    </header>

    <main class="magic-table">
        <div class="relative w-full flex justify-center mb-6 h-48">
            <div id="dropper" class="dropper">
                <svg width="30" height="70" viewBox="0 0 40 100">
                    <rect x="16" y="25" width="8" height="55" fill="#e2e8f0" rx="4" />
                    <circle id="dropper-color" cx="20" cy="20" r="18" fill="#cbd5e1" />
                    <path d="M18 80 L22 80 L20 95 Z" fill="#94a3b8" />
                </svg>
            </div>

            <div class="beaker-container" id="beaker">
                <div class="beaker-rim"></div>
                <div class="beaker-glass">
                    <div class="beaker-face">
                        <div class="eyes-row">
                            <div class="beaker-eye"></div>
                            <div class="beaker-eye"></div>
                        </div>
                        <div class="beaker-mouth"></div>
                    </div>
                    <div id="liquid" class="liquid" style="background-color: #f8fafc;"></div>
                </div>
            </div>
        </div>

        <div id="result-text" class="text-center font-bold text-gray-500 mb-6 h-12 flex items-center justify-center leading-tight">
            å¿«å¿«å¿«ï¼<br>æ‹–ä¸ªé¢œè‰²è¿›æ¥å§ï¼
        </div>

        <div class="flex justify-around items-end w-full" id="color-palette">
            <div class="flex flex-col items-center">
                <div draggable="true" data-color="red" data-hex="#ef4444" class="monster-wrapper monster-red w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <defs><radialGradient id="redGrad" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#ff6b6b"/><stop offset="100%" style="stop-color:#ef4444"/></radialGradient></defs>
                        <path d="M50 25 Q55 10 65 15" stroke="#b91c1c" stroke-width="3" fill="none" stroke-linecap="round" />
                        <circle cx="65" cy="15" r="3" fill="#ff6b6b" />
                        <ellipse cx="50" cy="58" rx="40" ry="36" fill="url(#redGrad)" />
                        <path d="M25 45 Q35 35 55 38" stroke="white" stroke-width="4" fill="none" opacity="0.3" stroke-linecap="round" />
                        <g class="monster-eye"><circle cx="40" cy="52" r="7.5" fill="white"/><circle cx="60" cy="52" r="7.5" fill="white"/><circle cx="40" cy="53" r="4.5" fill="#450a0a"/><circle cx="60" cy="53" r="4.5" fill="#450a0a"/></g>
                        <path d="M45 74 Q50 79 55 74" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    </svg>
                </div>
                <span class="text-red-500 text-xs mt-1 font-bold">çº¢ç²¾çµ</span>
            </div>

            <div class="flex flex-col items-center">
                <div draggable="true" data-color="yellow" data-hex="#fbbf24" class="monster-wrapper monster-yellow w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <ellipse cx="15" cy="65" r="8" ry="5" fill="#fcd34d" transform="rotate(-20 15 65)" />
                        <ellipse cx="85" cy="65" r="8" ry="5" fill="#fcd34d" transform="rotate(20 85 65)" />
                        <path d="M22 85 Q20 85 20 80 L23 45 Q25 30 50 30 Q75 30 77 45 L80 80 Q80 85 78 85 Z" fill="#fbbf24" />
                        <g class="monster-eye"><circle cx="40" cy="58" r="8" fill="white"/><circle cx="60" cy="58" r="8" fill="white"/><circle cx="40" cy="58" r="4.5" fill="#451a03"/><circle cx="60" cy="58" r="4.5" fill="#451a03"/></g>
                        <circle cx="50" cy="72" r="3.5" fill="#92400e" />
                    </svg>
                </div>
                <span class="text-yellow-600 text-xs mt-1 font-bold">é»„ç²¾çµ</span>
            </div>

            <div class="flex flex-col items-center">
                <div draggable="true" data-color="blue" data-hex="#3b82f6" class="monster-wrapper monster-blue w-16 h-16">
                    <svg viewBox="0 0 100 100">
                        <defs><radialGradient id="blueGrad" cx="50%" cy="50%" r="50%"><stop offset="0%" style="stop-color:#60a5fa"/><stop offset="100%" style="stop-color:#3b82f6"/></radialGradient></defs>
                        <line x1="50" y1="20" x2="50" y2="35" stroke="#2563eb" stroke-width="4" stroke-linecap="round" />
                        <circle cx="50" cy="18" r="5" fill="#60a5fa" />
                        <path d="M50 28 C25 28 15 50 15 70 C15 85 30 92 50 92 C70 92 85 85 85 70 C85 50 75 28 50 28 Z" fill="url(#blueGrad)" />
                        <g class="monster-eye"><circle cx="40" cy="62" r="8" fill="white"/><circle cx="60" cy="62" r="8" fill="white"/><circle cx="40" cy="63" r="4.5" fill="#1e3a8a"/><circle cx="60" cy="63" r="4.5" fill="#1e3a8a"/></g>
                        <path d="M46 78 Q50 82 54 78" stroke="white" stroke-width="2.5" fill="none" stroke-linecap="round"/>
                    </svg>
                </div>
                <span class="text-blue-600 text-xs mt-1 font-bold">è“ç²¾çµ</span>
            </div>
        </div>

        <button onclick="resetLab()" class="mt-8 w-full bg-orange-400 text-white py-3 rounded-2xl font-bold shadow-[0_4px_0_#c2410c] active:shadow-none active:translate-y-1 transition-all">
            ğŸ§¹ æ¸…ç†å®éªŒå®¤
        </button>
    </main>

    <footer class="mt-6 w-[90vw] max-w-[320px] p-4 bg-white/40 border border-white/60 rounded-2xl text-xs text-gray-500 shadow-sm">
        <p class="font-bold mb-1">ğŸª„ è°ƒè‰²å£è¯€ï¼š</p>
        <p>â¤ï¸ + ğŸ’› = ğŸ§¡ æ©™è‰² | ğŸ’› + ğŸ’™ = ğŸ’š ç»¿è‰² | â¤ï¸ + ğŸ’™ = ğŸ’œ ç´«è‰²</p>
    </footer>

    <script>
        let currentColors = { red: false, yellow: false, blue: false };
        const liquid = document.getElementById('liquid');
        const resultText = document.getElementById('result-text');
        const beaker = document.getElementById('beaker');
        const beakerInner = beaker.querySelector('.beaker-glass');
        const dropper = document.getElementById('dropper');
        const dropperColor = document.getElementById('dropper-color');
        const monsters = document.querySelectorAll('.monster-wrapper');

        let isAnimating = false;
        let bubbleInterval = null;

        function createParticles() {
            for (let i = 0; i < 8; i++) {
                const p = document.createElement('div');
                p.className = 'magic-particle';
                const size = Math.random() * 30 + 15 + 'px';
                p.style.width = size; p.style.height = size;
                p.style.background = ['#ff9a9e', '#fad0c4', '#a1c4fd', '#c2e9fb'][i % 4];
                p.style.left = Math.random() * 100 + 'vw';
                p.style.animationDelay = Math.random() * 5 + 's';
                document.body.appendChild(p);
            }
        }
        createParticles();

        monsters.forEach(m => {
            m.addEventListener('dragstart', (e) => {
                if(isAnimating) { e.preventDefault(); return; }
                e.dataTransfer.setData('color', e.currentTarget.dataset.color);
                e.dataTransfer.setData('hex', e.currentTarget.dataset.hex);
            });
            
            let draggedEl = null;
            let startX, startY;
            m.addEventListener('touchstart', e => {
                if (isAnimating) return;
                draggedEl = e.currentTarget;
                const rect = draggedEl.getBoundingClientRect();
                startX = e.touches[0].clientX - rect.left;
                startY = e.touches[0].clientY - rect.top;
                draggedEl.classList.add('dragging');
                draggedEl.style.position = 'fixed';
                draggedEl.style.width = rect.width + 'px';
                e.preventDefault();
            }, {passive: false});

            m.addEventListener('touchmove', e => {
                if (!draggedEl) return;
                draggedEl.style.left = (e.touches[0].clientX - startX) + 'px';
                draggedEl.style.top = (e.touches[0].clientY - startY) + 'px';

                // æ£€æµ‹æ˜¯å¦åœ¨çƒ§æ¯ä¸Šæ–¹
                const touch = e.touches[0];
                const bRect = beaker.getBoundingClientRect();
                if (touch.clientX > bRect.left && touch.clientX < bRect.right &&
                    touch.clientY > bRect.top && touch.clientY < bRect.bottom) {
                    beaker.classList.add('ready');
                } else {
                    beaker.classList.remove('ready');
                }
            }, {passive: false});

            m.addEventListener('touchend', e => {
                if (!draggedEl) return;
                const touch = e.changedTouches[0];
                const bRect = beaker.getBoundingClientRect();
                const isOver = (touch.clientX > bRect.left && touch.clientX < bRect.right &&
                               touch.clientY > bRect.top && touch.clientY < bRect.bottom);
                
                beaker.classList.remove('ready'); // ç¡®ä¿æ¢å¤çŠ¶æ€

                if (isOver) {
                    handleDrop(draggedEl.dataset.color, draggedEl.dataset.hex);
                }
                
                draggedEl.classList.remove('dragging');
                draggedEl.style.position = '';
                draggedEl.style.left = ''; draggedEl.style.top = '';
                draggedEl = null;
            });
        });

        // æ¡Œé¢æ‹–æ‹½è¿›å…¥é€»è¾‘
        beaker.addEventListener('dragenter', () => beaker.classList.add('ready'));
        beaker.addEventListener('dragleave', () => beaker.classList.remove('ready'));
        beaker.addEventListener('dragover', e => e.preventDefault());
        beaker.addEventListener('drop', e => {
            e.preventDefault();
            beaker.classList.remove('ready');
            handleDrop(e.dataTransfer.getData('color'), e.dataTransfer.getData('hex'));
        });

        function handleDrop(color, hex) {
            if (!color || currentColors[color] || isAnimating) return;
            isAnimating = true;

            // 1. çƒ§æ¯ç«‹åˆ»æ”¾å¤§ï¼ˆè§†è§‰åé¦ˆå·²æ¾å¼€å¹¶æ¥æ”¶ï¼‰
            beaker.classList.add('ready');
            
            // 2. æ»´ç®¡å‡†å¤‡å¹¶æ»‘å…¥
            dropperColor.setAttribute('fill', hex);
            dropper.classList.add('show');
            
            setTimeout(() => {
                // 3. äº§ç”Ÿæ°´æ»´å¹¶è½ä¸‹
                const drop = document.createElement('div');
                drop.className = 'water-drop';
                drop.style.backgroundColor = hex;
                drop.style.left = '50%';
                drop.style.marginLeft = '-7px';
                beaker.appendChild(drop);
                
                setTimeout(() => {
                    drop.remove();
                    currentColors[color] = true;
                    updateUI();
                    startBubblingEffect();
                    
                    // 4. é¢œè‰²æ¥è§¦åçš„ç¼©æ”¾åé¦ˆï¼ˆDuangçš„ä¸€ä¸‹ï¼‰
                    beaker.classList.remove('ready'); // ç§»é™¤é™æ€æ”¾å¤§
                    beaker.animate([
                        { transform: 'scale(1.15)' },
                        { transform: 'scale(0.95) translateY(4px)' },
                        { transform: 'scale(1.1) translateY(-6px)' },
                        { transform: 'scale(1)' }
                    ], { 
                        duration: 500,
                        easing: 'ease-out'
                    });

                    setTimeout(() => {
                        dropper.classList.remove('show');
                        isAnimating = false;
                    }, 300);
                }, 550);
            }, 400);
        }

        function startBubblingEffect() {
            for(let i=0; i<12; i++) {
                setTimeout(() => createOneBubble(), i * 100);
            }
            if(!bubbleInterval) {
                bubbleInterval = setInterval(() => {
                    if(Object.values(currentColors).some(v => v)) {
                        createOneBubble();
                    }
                }, 800);
            }
        }

        function createOneBubble() {
            const b = document.createElement('div');
            b.className = 'liquid-bubble';
            const size = (Math.random() * 12 + 6) + 'px';
            b.style.width = size;
            b.style.height = size;
            b.style.left = (Math.random() * 70 + 15) + '%';
            b.style.bottom = '10px';
            b.style.animationDuration = (Math.random() * 1 + 1) + 's';
            beakerInner.appendChild(b);
            setTimeout(() => b.remove(), 2000);
        }

        function resetLab() {
            if (isAnimating) return;
            currentColors = { red: false, yellow: false, blue: false };
            updateUI();
            if(bubbleInterval) {
                clearInterval(bubbleInterval);
                bubbleInterval = null;
            }
        }

        function updateUI() {
            const { red, yellow, blue } = currentColors;
            let hex = '#f8fafc';
            let msg = "å†åŠ ç‚¹é¢œè‰²è¿›æ¥å§ï¼";
            const count = Object.values(currentColors).filter(Boolean).length;
            
            if (count === 0) {
                msg = "å¿«å¿«å¿«ï¼<br>æ‹–ä¸ªé¢œè‰²è¿›æ¥å§ï¼";
            } else if (red && yellow && blue) {
                hex = '#451a03'; msg = "å“‡ï¼å˜æˆé…·é…·çš„ã€å¥‡è¿¹æ£•ã€‘ï¼";
            } else if (red && yellow) {
                hex = '#fb923c'; msg = "å˜¿ï¼å˜æˆäº†ã€æ©™è‰²ã€‘å¤§æ©˜å­ï¼";
            } else if (yellow && blue) {
                hex = '#4ade80'; msg = "å“‡ï¼å˜æˆäº†ã€ç»¿è‰²ã€‘å°é’è‰ï¼";
            } else if (red && blue) {
                hex = '#c084fc'; msg = "ç§ï¼å˜æˆäº†ã€ç´«è‰²ã€‘ç”œè‘¡è„ï¼";
            } else {
                if (red) hex = '#f87171';
                if (yellow) hex = '#fbbf24';
                if (blue) hex = '#60a5fa';
                msg = "é­”æ³•æ³¨å…¥ä¸­...<br>å†è¯•è¯•åŠ ä¸€ç§ï¼Ÿ";
            }
            
            liquid.style.backgroundColor = hex;
            liquid.style.height = count === 0 ? '5%' : (30 * count) + '%';
            resultText.innerHTML = msg;
        }
    </script>
</body>
</html>
